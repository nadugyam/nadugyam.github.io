---
title: "Impact of Smoking-Ban Laws on Mortality Rates"
subtitle: "A Difference-in-Difference Analysis"
author: "Nicholas Adu Gyamfi"
institute: "Old Dominion University"
format: 
  html:
    code-tools: true
    code-fold: true
    code-summary: "Show the code"
    code-copy: hover
    link-external-newwindow: true
    tbl-cap-location: top
    fig-cap-location: bottom
    toc: true
    toc-location: left
    journal:
      blinded: false
#  pdf: default
self-contained: true
editor: visual
# output:
#   html_document:
#     code_folding: hide
bibliography: references.bib
csl: nat.csl
nocite: |
  @CDCWonder1,@CDCWonder2,@CDCWonder3,@CDCWonder4,@CDCWonder5,@CDCWonder6,@270towin
---

```{r setup, include=FALSE}
#| include: false
#| ##DO NOT EDIT THIS

knitr::opts_chunk$set(fig.align = 'center')
knitr::opts_chunk$set(out.width = '90%')
knitr::opts_chunk$set(results = 'hold')
knitr::opts_chunk$set(fig.show = 'hold')
knitr::opts_chunk$set(error = TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
par(mar = c(4.1, 4.1, 1.1, 4.1))

hooks = knitr::knit_hooks$get()
hook_foldable = function(type) {
  force(type)
  function(x, options) {
    res = hooks[[type]](x, options)
    
    if (isFALSE(options[[paste0("fold.", type)]])) return(res)
    
    paste0(
      "<details open><summary>", gsub("^p", "P", gsub("^o", "O", type)), "</summary>\n\n",
      res,
      "\n\n</details>"
    )
  }
}

knitr::knit_hooks$set(
  output = hook_foldable("output"),
  plot = hook_foldable("plot")
)
```

```{r}
#| include: false
 
sbl_states <- read.csv("assets/res_states.csv")          # states/years of smoking bans
sbl_pol <- read.csv("assets/res_politic.csv")            # Political affiliation of states
sbl_death_pop <- read.csv("assets/res_us_deaths.csv")    # deaths and population

## Transform median age dataframe
sbl_age1 <- read.csv("assets/res_age.csv")               # Median Age by State
empty <- list()
for(i in 2:42){
  sbl_age1[,c(1, i)] -> tmp
  tmp$year <- colnames(sbl_age1)[i]
  colnames(tmp)[2] <- "m_age"
  colnames(tmp)[1] <- "state"
  empty[[length(empty) + 1]] <- tmp
  cat("\r", i)
}
sbl_age <- do.call(rbind, empty)
sbl_age$year <- as.numeric(gsub("X", "", sbl_age$year))

## Transform income dataframe
sbl_income1 <- read.csv("assets/res_income.csv")   # Median Income by States
empty <- list()
for(i in 2:42){
  sbl_income1[,c(1, i)] -> tmp
  tmp$year <- colnames(sbl_income1)[i]
  colnames(tmp)[2] <- "m_income"
  colnames(tmp)[1] <- "state"
  empty[[length(empty) + 1]] <- tmp
  cat("\r", i)
}
sbl_income <- do.call(rbind, empty)
sbl_income$year <- as.numeric(gsub("X", "", sbl_income$year))

## Transform College Edu by states dataframe
sbl_colled1 <- read.csv("assets/res_colled.csv")   # College Educated by States
empty <- list()
for(i in 2:42){
  sbl_colled1[,c(1, i)] -> tmp
  tmp$year <- colnames(sbl_colled1)[i]
  colnames(tmp)[2] <- "p_colledu"
  colnames(tmp)[1] <- "state"
  empty[[length(empty) + 1]] <- tmp
  cat("\r", i)
}
sbl_colled <- do.call(rbind, empty)
sbl_colled$year <- as.numeric(gsub("X", "", sbl_colled$year))

# Add median income (m_income) to sbl
indices_df1 <- match(paste(sbl_age$state, sbl_age$year), paste(sbl_income$state, sbl_income$year))
indices_df2 <- match(paste(sbl_income$state, sbl_income$year), paste(sbl_age$state, sbl_age$year))
sbl_age$m_income <- sbl_income$m_income[indices_df2]

# Add college education (sbl_colled) to sbl
indices_df1 <- match(paste(sbl_age$state, sbl_age$year), paste(sbl_colled$state, sbl_colled$year))
indices_df2 <- match(paste(sbl_colled$state, sbl_colled$year), paste(sbl_age$state, sbl_age$year))
sbl_age$p_colledu <- sbl_colled$p_colledu[indices_df2]

# Add deaths and population (sbl_death_pop) to sbl
indices_df1 <- match(paste(sbl_age$state, sbl_age$year), paste(sbl_death_pop$state, sbl_death_pop$year))
indices_df2 <- match(paste(sbl_death_pop$state, sbl_death_pop$year), paste(sbl_age$state, sbl_age$year))
sbl_age <- cbind(sbl_age, deaths = sbl_death_pop$death[indices_df2], population = sbl_death_pop$population[indices_df2])

# Add political party state voted for (sbl_pol) to sbl
indices_df1 <- match(paste(sbl_age$state, sbl_age$year), paste(sbl_pol$state, sbl_pol$year))
indices_df2 <- match(paste(sbl_pol$state, sbl_pol$year), paste(sbl_age$state, sbl_age$year))
sbl_age <- cbind(sbl_age, r_d = sbl_pol$r_d[indices_df2], 
                 r1_d0 = sbl_pol$r1_d0[indices_df2],
                 repub = sbl_pol$repub[indices_df2],
                 p_repub = sbl_pol$p_repub[indices_df2],
                 democ = sbl_pol$democ[indices_df2],
                 p_democ = sbl_pol$p_democ[indices_df2])


# Filter out the rows where the year is between 1989 and 2020
sbl <- sbl_age[!(sbl_age$year >= 1980 & sbl_age$year <= 1988), ]

#sbl <- sbl_age

```

```{r}
#| include: false

## Convert to numeric
sbl$deaths <- as.numeric(sbl$deaths) 
sbl$population <- as.numeric(sbl$population)
sbl$m_income <- as.numeric(sbl$m_income)

## Calc mortality Rate
sbl$mortal_rate <- (sbl$deaths / sbl$population) *100000

```

```{r}
#| include: false

state_yr_ref <- data.frame(state = c("Arizona","California","Colorado","Connecticut","Delaware","Hawaii","Illinois","Iowa","Kansas","Maine","Maryland","Massachusetts","Michigan","Minnesota","Montana","Nebraska","New Jersey","New Mexico","New York","North Dakota","Ohio","Oregon","Rhode Island","South Dakota","Utah","Vermont","Washington","Wisconsin"),

year =c(2007,1995,2006,2003,2002,2006,2008,2008,2010,2004,2008,2004,2010,2007,2005,2009,2006,2007,2003,2010,2006,2009,2005,2010,2007,2005,2005,2010))

## Match and add treatment year to the sbl SBL = treat_year
sbl$treat_year <- state_yr_ref$year[match(sbl$state, state_yr_ref$state)]

## Add huge values to all NA's in the treat year
#sbl$treat_year[is.na(sbl$treat_year)] <- 2020

## Measure relative time since treat_year for each Treatment state,
## For all controls states input -1000
CONTROL_NUMBER <- -1000
sbl$rel_time <- ifelse(is.na(sbl$treat_year), CONTROL_NUMBER, sbl$year - sbl$treat_year)

## Create Fake Time for control variables
rnd_time <- unique(sbl$state[sbl$rel_time == CONTROL_NUMBER])


placebo_date <- data.frame(state = rnd_time,
                           treat_date = sample(1995:2010, length(rnd_time), TRUE))

m <- match(sbl$state, placebo_date$state)

sbl$rel_time_fake <- ifelse(is.na(m), sbl$rel_time, sbl$year - placebo_date$treat_date[m])

m <- match(sbl$state,
           sbl$state[sbl$rel_time_fake == -1])

sbl$mortal_rate0 <- sbl$mortal_rate * 100 / sbl$mortal_rate[sbl$rel_time_fake == -1][m]

## Create did 
sbl$did <- ifelse(sbl$rel_time >=0, 1, 0)

## Create lmortal_rate
sbl$lmortal_rate <- log(sbl$mortal_rate)

## Treatment Status
sbl$treat <- ifelse(sbl$state %in% state_yr_ref$state, 1, 0)
#sbl$treat <- ifelse(ave(sbl$rel_time, sbl$state, FUN = max) < 0, 0, 1)

## Filter treatment states(1) and control states(0)
#sbl$treat_state <- ifelse(sbl$state %in% state_yr_ref$state, 1, 0)

## Evaluate DiD
#sbl$did <- ifelse(sbl$rel_time >= 0, 1, 0)
#sbl$post <- ifelse(sbl$rel_time >= 0, 1, 0)

## treat_post
sbl$treat_post <- ifelse(sbl$treat == 1 & sbl$year >= sbl$treat_year, 1, 0)

```

### Abstract:

This study examines the relationship between smoking ban laws and its impact on mortality rates. Many research findings report that implementation of smoking ban laws in the United States has been associated with a reduction in mortality rates, particularly for smoking-related diseases such as cancer and respiratory diseases [see @Zhang2018,; and @Mueller2014]. Other studies also note that these bans have been linked to a decrease in cardiovascular morbidity and mortality [see @Aggarwal2014]. Further other studies also observed the impact of these laws on the decline in the smoking rate among high-school students and adults [see @Fujikake2016]. Results of this study shows that implementing smoking ban laws was associated with a 10% decrease in mortality rate.

### Introduction:

Smoking ban laws represent one of the most significant policy measures aimed at reducing exposure to harmful tobacco smoke, not only for smokers but also for non-smokers through the reduction of secondhand smoke exposure. The rationale behind these bans is grounded in the well-documented evidence that cigarette smoking increases the risk of mortality and morbidity, including various cancers, cardiovascular diseases, and respiratory conditions. There is the need to understand the direct impact of smoking ban laws on public health, specifically mortality rates. Previous studies, such as those by [@Aggarwal2014,; @Mueller2014,; @Zhang2018,; and @Fujikake2016], have provided evidence supporting the positive impact of smoking bans on health outcomes.

However, there remains a gap in the literature regarding the quantification of these effects using robust econometric methods that can account for confounding factors and provide causal inference. The need to explore this gap and its impact on smoking bans are discussed below.

First, the heterogeneity of smoking ban laws across different jurisdictions presents a unique opportunity for analysis. Smoking bans vary widely in their scope, including differences in locations covered (e.g., public places, workplaces, prisons), the strictness of the bans (e.g., partial vs. comprehensive bans), and the enforcement mechanisms in place. This variation allows for a nuanced analysis of which types of bans are most effective, providing valuable insights for policymakers looking to design or amend smoking ban laws. By employing a difference-in-difference model, we are enable to isolate the effects of these variations, offering a more detailed understanding of how specific aspects of smoking ban laws contribute to mortality rate reductions.

Second, is the need to explore the temporal dynamics of the impact of smoking bans. The benefits of smoking bans may not be immediate and could vary over time as behaviors, social norms, and enforcement practices evolve. Longitudinal analysis using difference-in-difference methodology allows for the study of these temporal effects, shedding light on how the impact of smoking bans on mortality rates changes in the years following their implementation. This aspect is crucial for understanding the long-term benefits of smoking bans and for planning future public health interventions.

Additionally, smoking and its health consequences disproportionately affect certain populations, such as lower-income groups, individuals with mental health issues, and prisoners, as highlighted by @Zhang2018. By analyzing the effects of smoking bans on mortality rates across different demographic groups, the study provides insights into the equity of these public health interventions. This is particularly important for ensuring that smoking bans do not inadvertently widen health disparities and for designing complementary policies to support vulnerable populations.

We acknowledge the challenge posed by the potential influence of health-conscious states in considering the implementation of smoking ban laws, which presents a selection bias concern. Ideally, excluding these states from our analysis would address this issue. However, lacking specific information for their exclusion, we employ alternative strategies to mitigate potential effects.

By incorporating state fixed effects into our analysis, we aim to capture factors such as the inherent health consciousness of states [see @Bose2015,; and @Carro2012] , which may predispose them to lower mortality rates even prior to the enactment of smoking bans [see @Cebula2015,; and @Fox2017]. Additionally, the inclusion of covariates in our regression model allows us to account for unobservable variations in health behaviors, socioeconomic factors, and other pertinent variables across states.

Through these methodological approaches, we endeavor to mitigate confounding biases associated with unobservable state-level factors, thereby enhancing the validity and reliability of our findings regarding the relationship between smoking bans and mortality rates.

This study seeks to close this gap by employing a difference-in-difference (DiD) approach, to compares the changes in mortality rates before and after the implementation of smoking bans between states with and without such laws. This method allows for a more accurate estimation of the causal effect of smoking ban laws on mortality rates by controlling for time-invariant differences between the treated and control groups, as well as common trends affecting both groups.

Furthermore, understanding the effectiveness of smoking bans can inform policymakers and public health officials about the potential benefits of enacting or strengthening such laws. Given the high costs associated with smoking-related diseases, both in terms of human life and economic burden, evidence of the effectiveness of smoking bans is crucial for making informed decisions about public health policies.

Lastly, the paper aims to contribute to the broader literature on the impact of public health interventions on mortality rates. By providing empirical evidence on the effectiveness of smoking bans, the research serves as a reference for evaluating other health policies and interventions, thereby enriching the field of public health policy and economics.

### Brief History:

The evolution of smoking bans in the United States reflects growing public awareness of the health risks associated with smoking. It demonstrates a significant shift in societal attitudes towards smoking, with an increasing number of public spaces becoming smoke-free.

The movement that began with California's pioneering legislation in 1995 has led to widespread changes in laws and norms surrounding smoking across the country. California, the first state to enact a statewide smoking ban law in 1995 prohibited smoking in all enclosed workplaces. This legislation marked a significant step forward in public health policy and set a precedent for other states to follow.

The success of California's smoking ban inspired a wave of similar legislation across the country in the early 2000s. States like New York, Delaware, and Connecticut passed comprehensive smoking bans that included bars and restaurants. By the mid-2000s, several states had joined the movement, enacting laws that made enclosed public places and workplaces smoke-free.

As of the early 2020s, the majority of U.S. states have comprehensive smoking bans that include enclosed public places and workplaces.

Figure 1: Smoking bans by state as of 2010: <img src="assets/map_cig_2010.avif" alt="Current Cigarette Use among Adults" style="display: block; margin: 0 auto;"/>

Figure 1 above map depicts smoking bans by state as of 2010. About 20 states including DC had passed smoking bans in work-sites, restaurants and bars. Second four states had smoking prohibited in two venue types. Five states had smoking prohibited in one venue type whilst fourteen states were less restrictive or had no restrictions on smoking bans.

Table 1 (in the Appendix) depicts states that implemented smoking ban laws and the dates the implementation came into effect. It can be inferred from the table that California was the first to implement smoking ban in 1995. Delaware then followed, implementing a smoking ban in 2002 after seven years. Other states then followed successively after Delaware. The frequency of states increasing smoking ban legislation is depicted in the frequency distribution graph below.

```{r}

# Convert date string to Date object and extract year
sbl_states$Date <- format(as.Date(sbl_states$year, format = "%d-%b-%y"), "%Y")

# convert to numeric
sbl_states$Date <- as.numeric(sbl_states$Date)

# histogram
hist(sbl_states$Date, 
     main = "Fig 2: Dist. of Smoking Ban Laws Passed by States (1995 - 2010)",
     cex.main = 1.0,
     xlab = "Year", 
     ylab = "Frequency",
     col = "skyblue",
     border = "black",
     breaks = seq(min(sbl_states$Date) - 0.5, max(sbl_states$Date) + 0.5, by = 1),
     xlim = c(min(sbl_states$Date) - 0.5, max(sbl_states$Date) + 0.5),
     ylim = c(0, max(table(sbl_states$Date)) + 1),
     axes = FALSE)

# x-axis
axis(side = 1, at = seq(min(sbl_states$Date), max(sbl_states$Date), by = 1))

# y-axis
axis(side = 2)

# Grid
grid()

```

Figure 2 shows the distribution of states that passed smoking bans by year between 1995 to 2010. The graph shows that in 1995 only one state (California) had enacted a statewide smoking ban for restaurants. No other state enacted smoking bans from the period (1996 - 2001). After 2001 however, the pace of smoking ban laws seemed to have pickup. Increasing steadily from 2002 (Delaware) to a high in 2005-2007 when four states enacted smoking ban laws in each year. The growing pace seem to have fallen steadily again until 2009 when only two states enacted smoking bans. However, we see a huge jump in 2010 when five states enacted state smoking ban laws. This shows that majority of the states enacted smoking bans between the years 2002 and 2010.

```{r}

# Aggregate the data & calc. avg mortality rate for each state
agg_df <- aggregate(list(mortal_rate = sbl$mortal_rate), list(year = sbl$year), FUN = mean)
#agg_df <- aggregate(mortal_rate ~ year, data = sbl, FUN = mean)
#agg_df$year <- format(as.Date(agg_df$year, format = "%d-%b-%y"), "%Y")

# Scatterplot
plot(agg_df$year, agg_df$mortal_rate, 
     main = "Fig:3 Distribution of Yearly Mortality Rate by State",
     cex.main = 1.0,
     xlab = "Year", 
     ylab = "% Mortality Rate",
     pch = 19,
     col = "blue",
     xlim = c(1989, 2020),
     ylim = range(agg_df$mortal_rate)) 

lines(agg_df$year, agg_df$mortal_rate, 
      type = "l",  
      col = "tomato")

#axis(at = seq(1989, 2020, by = 5), las = 2)

# # Create bar plot
# barplot(agg_df$mortal_rate, 
#         names.arg = agg_df$year,
#         main = "Distribution of Mortality Rate by Year",
#         xlab = "Year",
#         ylab = "Mortality Rate",
#         col = "skyblue",
#         border = "black",
#         ylim = c(0, max(agg_df$mortal_rate) + 5))

# Grid
grid()




```

Figure 3 illustrates the distribution of yearly mortality rates by state. The graph demonstrates an overall increasing trend in mortality rates from 1989 to 2020. Beginning in 1989, the average mortality rate was approximately 75 percent, steadily climbing to a peak of around 87 percent in 1998. Subsequently, there was a gradual decline to about 79 percent by 2007. From 2007 to 2018, there was another gradual increase in mortality rates, peaking close to 98 percent. However, after 2018, there was a gradual decline, with mortality rates dropping to around 82 percent.

### Research Question:

The focus of this study is to study the effect of smoking bans on mortality rate, the following hypothesis will be tested"

Null Hypothesis (H0): The implementation of smoking bans has no effect on mortality rates associated with smoking-related diseases.

Alternative Hypothesis (H1): The implementation of smoking bans leads to a statistically significant change in mortality rates associated with smoking-related diseases compared to areas without such bans.

### Data Description:

The data utilized in this study covers the period from 1989 to 2020, and was compiled from various sources. Mortality rate data was obtained from the CDC Wonder database, collected on a state-by-state basis. This dataset includes information on mortality rates, population figures, median income levels, the percentage of college-educated individuals, median age demographics, and the political party affiliation of each state. Political party affiliation data specifically comprises the percentage of votes cast for the two major parties in the United States (Republican and Democrat). Additionally, information on the enactment years of "smoking ban laws" in states that implemented such laws between 1989 and 2020 was gathered for inclusion in the study.

<!--[Current Cigarette Use among Adults](../image/map_cig_use.PNG)-->

### Summary Statistics:

```{r}
library(modelsummary)

datasummary_skim(sbl[c("mortal_rate", "m_age","m_income","p_colledu","population")], histogram = TRUE, title = "Table: 2 Summary Statistics")

```

The summary statistics for the dataset are presented here. Across all states included in the analysis, the maximum age observed was approximately 45 years, while the minimum age was 25 years. The mean age across states was 36 years, with a standard deviation of 3.0. The highest reported median income was approximately 92,266 USD, whilst the lowest was 34,916 USD. The average median income across states was 58,976 USD, with a standard deviation of 9,808. The maximum mortality rate recorded was 150 deaths per hundred thousand population, with the minimum being 27 deaths per hundred thousand population. The mean mortality rate across states was 84 deaths per hundred thousand population, with a standard deviation of 17 deaths per hundred thousand population. In terms of educational attainment, the maximum percentage of college-educated individuals in the states was 64, while the minimum was 11. The mean percentage of college-educated individuals was 27, with a standard deviation of 6.6. Subsequently, the paper proceeds to present a theoretical model examining the impact of smoking ban laws on mortality rates.

```{r}
#| include: false
#| ## The Relationship Between Smoking Ban Laws and Mortality Rates

set.seed(757)

numer <- aggregate(list(mortality = sbl$mortal_rate0 * sbl$population),
          list(rel_time = sbl$rel_time_fake,
               treat = !is.na(sbl$treat_year)),
          sum, na.rm = TRUE) 

denom <- aggregate(list(pop = sbl$population),
          list(rel_time = sbl$rel_time_fake,
               treat = !is.na(sbl$treat_year)),
          sum, na.rm = TRUE) 

numer$mortality_rate <- numer$mortality/denom$pop
temp <- numer

# Find the mean of deaths grouped by rel_years and treat_state
agg <- aggregate((sbl$deaths/sbl$population)*100000, list(sbl$rel_time, sbl$treat), mean)

# Plot of DiD Curves
lim <- temp$rel_time %in% -3:3

plot(temp$rel_time[lim], 
     temp$mortality_r[lim],
     las = 1, 
     ylim = c(90,110),
     #xlim = c(-5, 5),
     main = "Fig: 4 Graph of Average Mortality Rate by years",
     type = "n",
     ylab = "Average Mortality Rate",
     xlab = " Years")

lines(temp$rel_time[temp$treat == 0 & lim],
     temp$mortality_rate[temp$treat == 0 & lim],
     lty = 1, pch = 4, type = "b")

lines(temp$rel_time[temp$treat == 1 & lim],
     temp$mortality_rate[temp$treat == 1 & lim],
     lty = 1, pch = 19, type = "b", col = "tomato")
abline(v = 0)

```

### Empirical Strategy:

To estimate the effect of smoking ban laws on mortality rate, I model a two way fixed-effects (TWFE) regression as presented below.

$$
ln(Mortality\_Rate_{it}) = \beta_1SBL_{it} + \beta_2X_{it} + \alpha_i + \lambda_t + \epsilon_{it}  \qquad \qquad (eqn_1)
$$

The variables in the model are described as follows, $Mortality\_Rate_{it}$ represents the outcome or dependent variable (mortality rate per state in a given year) which our model seeks to predict. $SBL_{it}$ represents our independent variable (the implementation of smoking ban laws) for a given state in a given year. The parameter of interest $\beta_1$ captures the causal impact of variation in smoking ban law on mortality rate for a given state in a given year. The vector $X_{it}$ represents control variables such as median age, median income, percentage of population with college education among others. Also $\alpha_i$ and $\lambda_t$ represents state and year fixed effects respectively.

We control for median income in our model as there is a direct relationship between median income and health outcomes. It is presumed that regions with higher median income usually have better access to healthcare, healthier lifestyles, and improved living conditions. These regions are more likely to implement smoking bans which could lead to lower mortality rates. These regions may also have lower mortality rates due to other factors related to higher socioeconomic status. Not only this, but median income can also vary widely across different geographic areas, even within the same state. By including median income as a control variable, we are able to account for this spatial variability and better capture the nuanced relationship between smoking bans and mortality rates. Controlling for median income helps reduce the bias and ensure that the estimated effects of smoking bans are devoid of underlying socioeconomic differences between regions.

Second, we account for the effect of median age in our model. Median age provides insight into the age structure of the area of interest. States with higher median ages tend to have older populations, while states with lower median ages have younger populations. The age structure is related to health status and mortality risks as older individuals generally have higher mortality rates due to such factors as age-related illnesses and decreased resilience to diseases. Thus, controlling for median age in our analysis enables us to account for variations in mortality rates that are attributable to differences in the age structure of the population. In addition, median age may interact with smoking bans in influencing mortality rates. For example, the effectiveness of smoking bans in reducing mortality rates may vary across different age groups. By examining potential interaction effects between smoking bans and median age, we are able to explore the impact of smoking bans on mortality rates among age groups.

In addition, we control for college education a proxy for socioeconomic status. Populations with higher levels of educated individuals tend to have better access to resources including healthcare and as such are more likely to adopt healthier behaviors. Not only this, states with higher college-educated individuals may have lower mortality rates due to other socioeconomic factors such as stable employment opportunities, higher income levels, access to healthcare coverage and resources for maintaining good health. Also, educated individuals are more likely to have higher levels of health literacy and awareness about the risks of smoking. They are therefore more inclined to adopt healthier lifestyles. Further, college education may also interact with smoking bans in influencing mortality rates. For instance, the effectiveness of smoking bans in reducing mortality rates may vary among different educational levels. Controlling for college education enables us to explore potential interaction effects and examine whether the impact of smoking bans differs across various educational levels.

In our model we decide to weight our estimates by population for the following reasons. First by using population weights we ensure that the sample used in our analysis accurately depicts the demographic composition of the population. Weighting balances over representation in the analysis that could bias the outcome of our estimates. By weighting we are able to reduce sampling bias and account for variations in the size of different subgroups within the population. In effect we are able to generalize our findings beyond the sample to the broader population. Thus, assigning weights enables us to adjust for discrepancies and ensure that our estimates are representative of the entire population.

**TWFE Bias and Goodman-Bacon Analysis**:

The estimated coefficient of interest of the TWFE staggered treatment model often fails to capture expected estimates. This modeling challenge is often due to improper comparison of treatment and control groups at different points in time as treatment timing is staggered and treatment effects are heterogeneous. This may be due to such factors as spill over of earlier treatment to later periods, differences in implementation timing, improper comparison of treatment and control groups at different points in time. These challenges could result in biased estimates of the overall treatment effect.

Given that our model represents staggered implementation of smoking bans across different states over a period of time, coefficient from our TWFE model would be biased. To analyses the underlying cause of this bias, we employ Goodman-Bacon’s function to decomposing our TWFE model into individual components. Bacon’s function decomposes the TWFE model by isolating trends in the model as well as exposing interactions between the various control and treatment groups in the TWFE model. As Bacon's function shows the cause but does not provide a fix, we employ the two-stage difference-in-difference model proposed by @Gardner2022.

##### **Two Stage Diff and Diff**:

$$
(Mortality{\_}Rate_{it} - \hat\alpha_i + \hat\lambda_t) = \beta_1SBL_{it} + \beta_2X_{it} + \epsilon_{it}   \qquad \qquad (eqn_2)
$$

Gardner proposed the removal of the state and year fixed effects estimates from our outcome variable so that the eventual regression is devoid of the bias. This is possible as the state and year fixed effects do not vary by time and as such all estimates yield the same results.

To do this, we first estimate our state and year fixed effects from the untreated time periods in our initial stage. We then subtract the unbiased estimated state and year fixed effects from our outcome variable (mortality rate). Finally, we fit the output of the first stage on the treatment variable without the fixed effects estimates.

Results from our estimates are presented in the next section.

### Results:

```{r}
#| Output of TWFE Model
library(fixest)

sbl$lmortal_rate <- log(sbl$mortal_rate)
sbl$lm_income <- log(sbl$m_income)

## Two Way Fixed Effects | no controls | unweighted
r0a <- fixest::feols(lmortal_rate ~ did | as.factor(state) + as.factor(year), 
                     data = sbl)
#summary(r0a)

## Two Way Fixed Effects | no controls | weighted
r0b <- fixest::feols(lmortal_rate ~ did | as.factor(state) + as.factor(year), 
                     data = sbl, weights = ~population)
#summary(r0b)

## Two Way Fixed Effects | with controls | weighted
r0c <- fixest::feols(lmortal_rate ~ did + m_age + lm_income + p_colledu | 
                       state + year, data = sbl, weights = ~population)
#summary(r0c)


regz <- list(`2WFE | no Controls | unweighted` = r0a,
             `2WFE | no Controls | weighted*` = r0b,
             `2WFE | with Controls | weighted*` = r0c)

## Use modelsummary to output the results
coefz <- c("did" = "Smoking Ban Laws (SBL)",
           "year" = "Year Fixed Effect",
           "lmortal_rate" = "Log Mortality Rate",
           "state" = "State Fixed Effect",
           "population" = "Population",
           "(Intercept)" = "Constant")

gofz <- c("nobs", "r.squared")

modelsummary(regz,
             title = "Table 3: TWFE with State Model Smoking Ban laws and Mortality Rates",
             estimate = "{estimate}{stars}",
             coef_map = coefz,
             gof_map = gofz,
             notes = "*Weights are by population")

```

Table 3 above depicts the output of three TWFE models of the relationship between smoking ban laws and mortality rates. column one models a regression with no controls and unweighted. Column two's represents a TWFE model with no controls but weighted. In column three the model has both controls and it is also weighted by the population of each state. Also standard errors for this estimates are clustered at the state level.

The analysis of column one reveals that the enactment of smoking ban laws is associated with a 6.2 percentage decrease in mortality rates, with statistical significance observed at the 5 percent level. The results derived from column two indicate that the implementation of smoking ban laws is linked to a 4.5 percent decrease in mortality rates, with statistical significance observed at the 5 percent level. Column three models a fixed effects regression where controls and weights are included to account for unobserved heterogeneity. The findings of this model indicate that the implementation of smoking ban laws resulted in a statistically significant reduction in mortality rates by 5.2 percent, with the significance observed at the 1 percent level.

In the next step we decompose the TWFE model, with the Goodman-Bacon function, into its component parts.

**Goodman-Bacon Decomposition:**

```{r}
#| echo: true
#| results: hide

cat("\n##### Goodman-Bacon Decomp #####\n")
bacondecomp::bacon(formula = lmortal_rate ~ did,
                                 id_var = "state",
                                 time_var= "year",
                                 data = sbl,
                                 quietly = FALSE)
```

```{r}
#| echo: false

datasummary_df(data.frame(
                 Type=c("Earlier vs Later Treated", "Later vs Earlier Treated", "Treated vs Untreated"),
                 Weight =c(0.08899, 0.08588, 0.82513),
                 Average_Estimate =c(-0.02067, 0.04167,-0.07763)),fmt = fmt_significant(5), align = "lcc")

```

The Goodman-Bacon decomposition analysis, illustrates the weighted average of all possible 2x2 Difference-in-Differences (DiD) configurations within the model. Decomposing the Two-Way Fixed Effects (TWFE) framework reveals three distinct configurations:

1.  First, the "treated vs untreated" model, with a weight of 0.82513, shows a negative average estimate of -0.07763.
2.  Second, the "earlier vs later treated" model, with a weight of 0.08899, shows a negative average estimate of -0.02067.
3.  Lastly, the "later vs earlier treated" model, with a weight of 0.08588, shows a positive average estimate of 0.04167.

The decomposed TWFE exposes clear distinctions between reliable estimates (earlier vs later treated and treated vs untreated) and the flawed estimate (later vs earlier treated). This flaw arises due to the inclusion of a "control" group tainted by prior treatment. This is also evidenced by its positive average estimate compared to the negative estimates of other groups. Consequently, this tainted estimate reduces the magnitude of the coefficient of the variable of interest ($\delta^{DD}$).

Upon identifying this flaw, we proceed to re-estimate our model using the two-stage Difference-in-Differences framework in the next step. This model rectifies the issue by removing the state and year fixed effects from the outcome variable before estimating the coefficient ($\delta^{DD}$) in the model.

**Two Stage Diff in Diff**

```{r}

library(did2s)

r2 <- did2s::did2s(sbl,
                   yname = "lmortal_rate",
                   first_stage = ~ 0 | state + year,
                   second_stage = ~ did,
                   treatment = "did",
                   cluster_var = "state")
#r2

r3 <- did2s::did2s(sbl,
                   yname = "lmortal_rate",
                   first_stage = ~ 0 | state + year,
                   second_stage = ~ did,
                   treatment = "did", 
                   weights = "population",
                   cluster_var = "state")
#r3

regz <- list(`Two Stage DiD no weights` = r2,
             `Two stage DiD with weights` = r3)

## Use modelsummary to output the results
coefz <- c("lmortal_rate" = "Log Mortality Rate",
           "did" = "Smoking Ban Laws (SBL)",
           "population" = "Population",
           "state" = "State Fixed Effect",
           "year" = "Year Fixed Effect",
           "(Intercept)" = "Constant")

gofz <- c("nobs", "r.squared")

modelsummary(regz,
             title = "Table 4: Two Stage Difference in Difference ",
             estimate = "{estimate}{stars}",
             coef_map = coefz,
             gof_map = gofz)
```

Table 4 depicts the estimates of the effect of smoking ban laws on mortality rates using the "two stage DiD framework". From the first column, without fixed effects smoking ban laws is associated with a 10.1 percent reduction in mortality rate, this value is significant at the 0.01 level. When state fixed effects are added, smoking ban laws is associated with a 1.9 percent reduction in mortality rates, this value is insignificant. Event study of the two stage DiD is conducted next.

```{r}
#| include: false

library(fixest)

#Event Study Estimate for Two Way Fixed Effects (2WFE)

## 
es1 <- feols(lmortal_rate ~ i(rel_time, treat, ref = c(-1, -10000)) 
             | state + year + sw0(state[year]), data = sbl)


## Event Study for 2WFE
par(mfrow = c(1,2))
iplot(es1[[1]], xlim = c(-10, 10))
iplot(es1[[2]], xlim = c(-10, 10))
par(mfrow = c(1,1))




```

**Figure 4: Event Study of Effect of Smoking Ban Law on Mortality Rate:**

```{r}

library(fixest)

es2 <- did2s::did2s(sbl,
                   yname = "lmortal_rate",
                   first_stage = ~ 0 | state + year,
                   second_stage = ~ i(rel_time, ref = c(-1, -1000)),
                   treatment = "did",
                   cluster_var = "state")

es3 <- did2s::did2s(sbl,
                   yname = "lmortal_rate",
                   first_stage = ~ 0 | state + year,
                   second_stage = ~ i(rel_time, ref = c(-1, -1000)),
                   treatment = "did", weights = "population",
                   cluster_var = "state")


## Event Study for did2s
par(mfrow = c(1,2))
iplot(es2, xlim = c(-10, 10), main = "", col = "blue")
title(main = "A: Effect of SBL on Mortality Rate, no weights", cex.main = 0.8)
iplot(es3, xlim = c(-10, 10), main = "", col = "tomato")
title(main = "B: Effect of SBL on Mortality Rate, with weights", cex.main = 0.8)
par(cex.main = 0.1)
par(mfrow = c(1,1))
```

Figure 4 shows the event study of the effect of smoking ban laws on mortality rate generated from a two stage difference in difference framework. Figure A depicts the event study of the model from table 4 column one. Estimates from this column has no weights and is significant. The event study shows a downward trending graph due to the treatment effect. Figure B shows an event study of the model from table 4 column two. The event study shows an oscillating graph around the x-axis and subsequent downward trending graph, estimates from this model was insignificant.

### Conclusion and Implications:

The goal of this study is to investigate the effect of the implementation of smoking ban laws on morality rates using a difference and difference analysis. A phenomenon that was started in California in 1995, smoking bans laws as of 2010 have been implemented in twenty eight states.

This study leverages data from various sources to study the effect of smoking bans on mortality rates. Exploring the data from the CDC Mobility and Mortality weekly report for the periods 1989 to 2010. Estimates from table table 4 shows that mortality rates fall by nearly 8 percent when evaluated with no weights considered. However when weights was considered, mortality rates fall by nearly 10.3 percent after implementation of the smoking ban laws.

Results from this study confirms the negative association of smoking ban laws with mortality rates. Results from this study is comparable to other research findings. @Gao2019 found an 8% decrease in the AMI mortality rate. @Akter2023 found that smoke-free legislation was associated with approximately 9% to 10% cerebrovascular deaths (CVD).

### Appendix:

```{r}

library(modelsummary)

ban_yr <- read.csv("assets/res_states.csv")

# Rename the columns
names(ban_yr) <- c("State", "Year")

# Print the title
#cat("Table 1: Smoking Ban Laws enactment by State, 1995 - 2010:\n")

# Center justify the table and print
#print(format(ban_yr, justify = "center"))

datasummary_df(
  data = ban_yr,
  output = "default",
  align = "cc",
  title = "Table 1: Smoking Ban Laws Enactment by States, 1995 - 2010",
  notes = "https://www.cdc.gov/tobacco/data_statistics/mmwrs/index.htm "
)

```
